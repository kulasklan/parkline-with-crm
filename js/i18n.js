// Internationalization (i18n) system for ParkLine Residences
class I18nManager {
    constructor() {
        this.currentLanguage = 'mk'; // Default to Macedonian
        this.translations = {
            mk: {
                // Header and Navigation
                'view-1': '–ü–æ–≥–ª–µ–¥ 1',
                'view-2': '–ü–æ–≥–ª–µ–¥ 2',
                
                // Filters
                'filter-floor': '–°–ü–†–ê–¢:',
                'filter-bedrooms': '–°–ü–ê–õ–ù–ò –°–û–ë–ò:',
                'filter-area': '–í–ö–£–ü–ù–û (–ú¬≤):',
                'clear-filters': '–û—Ç—Å—Ç—Ä–∞–Ω–∏ –º–∞—Å–∫–∏',
                'restore-filters': '–í—Ä–∞—Ç–∏ –º–∞—Å–∫–∏',
                
                // Status
                'status-available': '–°–õ–û–ë–û–î–ï–ù',
                'status-reserved': '–†–ï–ó–ï–†–í–ò–†–ê–ù',
                'status-sold': '–ü–†–û–î–ê–î–ï–ù',
                
                // Apartment Details
                'apartment-details': '–î–µ—Ç–∞–ª–∏ –∑–∞ —Å—Ç–∞–Ω–æ—Ç',
                'apartment-no': '–°—Ç–∞–Ω –±—Ä.',
                'office-space': '–î–µ–ª–æ–≤–µ–Ω –ø—Ä–æ—Å—Ç–æ—Ä',
                'bedrooms': '–°–ø–∞–ª–Ω–∏ —Å–æ–±–∏',
                'floor': '–°–ø—Ä–∞—Ç',
                'area': '–ü–æ–≤—Ä—à–∏–Ω–∞',
                'status': '–°—Ç–∞—Ç—É—Å',
                'room': '—Å–æ–±–∞',
                'rooms': '—Å–æ–±–∏',
                'floor-suffix': '. —Å–ø—Ä–∞—Ç',
                'link': 'Link',
                'na': '–ù/–ê',
                
                // Loading and Error Messages
                'app-title': 'ParkLine Residences',
                'loading-data': '–°–µ –≤—á–∏—Ç—É–≤–∞–∞—Ç –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ –∑–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç–µ...',
                'initializing': '–°–µ –∏–Ω–∏—Ü–∏—ò–∞–ª–∏–∑–∏—Ä–∞...',
                'step': '–ß–µ–∫–æ—Ä',
                'application-error': '–ì—Ä–µ—à–∫–∞ –≤–æ –∞–ø–ª–∏–∫–∞—Ü–∏—ò–∞—Ç–∞',
                'error-message': '–°–µ —Å–ª—É—á–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ –≤—á–∏—Ç—É–≤–∞—ö–µ—Ç–æ –Ω–∞ –≤–∏–∑—É–µ–ª–∏–∑–∞—Ü–∏—ò–∞—Ç–∞ –Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç–µ. –û–≤–∞ –º–æ–∂–µ –¥–∞ —Å–µ –¥–æ–ª–∂–∏ –Ω–∞ –ø—Ä–æ–±–ª–µ–º–∏ —Å–æ –º—Ä–µ–∂–Ω–∞—Ç–∞ –≤—Ä—Å–∫–∞ –∏–ª–∏ –≤—á–∏—Ç—É–≤–∞—ö–µ—Ç–æ –Ω–∞ –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ.',
                'reload-application': 'üîÑ –†–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞—ò –∞–ø–ª–∏–∫–∞—Ü–∏—ò–∞',
                'technical-details': '–¢–µ—Ö–Ω–∏—á–∫–∏ –¥–µ—Ç–∞–ª–∏',
                'error': '–ì—Ä–µ—à–∫–∞:',
                'retry-attempts': '–û–±–∏–¥–∏ –∑–∞ –ø–æ–≤—Ç–æ—Ä—É–≤–∞—ö–µ:',
                'load-time': '–í—Ä–µ–º–µ –Ω–∞ –≤—á–∏—Ç—É–≤–∞—ö–µ:',
                
                // Analytics
                'total-apartments': '–í–∫—É–ø–Ω–æ —Å—Ç–∞–Ω–æ–≤–∏',
                'units': '–µ–¥–∏–Ω–∏—Ü–∏',
                'available': '–°–ª–æ–±–æ–¥–Ω–∏',
                'reserved': '–†–µ–∑–µ—Ä–≤–∏—Ä–∞–Ω–∏',
                'sold': '–ü—Ä–æ–¥–∞–¥–µ–Ω–∏',
                'percent-of-total': '% –æ–¥ –≤–∫—É–ø–Ω–æ',
                'bedroom-distribution': '–†–∞—Å–ø—Ä–µ–¥–µ–ª–±–∞ –ø–æ —Å–ø–∞–ª–Ω–∏ —Å–æ–±–∏',
                'bedrooms-label': '–°–ø–∞–ª–Ω–∏ —Å–æ–±–∏:',
                'data-status': '–°—Ç–∞—Ç—É—Å –Ω–∞ –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ',
                'source': '–ò–∑–≤–æ—Ä:',
                'last-update': '–ü–æ—Å–ª–µ–¥–Ω–æ –∞–∂—É—Ä–∏—Ä–∞—ö–µ:',
                'apartments-loaded': '–í—á–∏—Ç–∞–Ω–∏ —Å—Ç–∞–Ω–æ–≤–∏:',
                'current-view': '–¢–µ–∫–æ–≤–µ–Ω –ø–æ–≥–ª–µ–¥:',
                
                // Mobile Filter Toggle
                'show-filters': '–§–ò–õ–¢–†–ò',
                'hide-filters': '–°–û–ö–†–ò–à –§–ò–õ–¢–†–ò',
                
                // Contact Button
                'interested-button': '–°–µ –∏–Ω—Ç–µ—Ä–µ—Å–∏—Ä–∞–º',
                'email-subject': '–°–µ –∏–Ω—Ç–µ—Ä–µ—Å–∏—Ä–∞–º –∑–∞ —Å—Ç–∞–Ω %ID% - ParkLine Residences',
                
                // Contact Form
                'contact-form-title': '–ö–æ–Ω—Ç–∞–∫—Ç–∏—Ä–∞—ò—Ç–µ –Ω–µ',
                'contact-form-description': '–ü–æ–ø–æ–ª–Ω–µ—Ç–µ —ò–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–æ–¥–æ–ª—É –∑–∞ –¥–∞ —Å–µ —Ä–∞—Å–ø—Ä–∞—à–∞—Ç–µ –∑–∞ —Å—Ç–∞–Ω –∏–ª–∏ –∑–∞ –æ–ø—à—Ç–∏ –ø—Ä–∞—à–∞—ö–∞.',
                'form-name-label': '–ò–º–µ:',
                'form-email-label': '–ï-–ø–æ—à—Ç–∞:',
                'form-phone-label': '–¢–µ–ª–µ—Ñ–æ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ):',
                'form-message-label': '–ü–æ—Ä–∞–∫–∞:',
                'form-apartment-id-label': 'ID –Ω–∞ —Å—Ç–∞–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ):',
                'form-submit-button': '–ò—Å–ø—Ä–∞—Ç–∏ –±–∞—Ä–∞—ö–µ'
            },
            en: {
                // Header and Navigation
                'view-1': 'View 1',
                'view-2': 'View 2',
                
                // Filters
                'filter-floor': 'FLOOR:',
                'filter-bedrooms': 'BEDROOMS:',
                'filter-area': 'TOTAL (M¬≤):',
                'clear-filters': 'Clear Filters',
                'restore-filters': 'Restore Filters',
                
                // Status
                'status-available': 'AVAILABLE',
                'status-reserved': 'RESERVED',
                'status-sold': 'SOLD',
                
                // Apartment Details
                'apartment-details': 'Apartment Details',
                'apartment-no': 'Apartment No.',
                'office-space': 'Office Space',
                'bedrooms': 'Bedrooms',
                'floor': 'Floor',
                'area': 'Area',
                'status': 'Status',
                'room': 'room',
                'rooms': 'rooms',
                'floor-suffix': '. floor',
                'link': 'Link',
                'na': 'N/A',
                
                // Loading and Error Messages
                'app-title': 'ParkLine Residences',
                'loading-data': 'Loading apartment data...',
                'initializing': 'Initializing...',
                'step': 'Step',
                'application-error': 'Application Error',
                'error-message': 'We encountered an issue loading the apartment visualization. This might be due to network connectivity or data loading problems.',
                'reload-application': 'üîÑ Reload Application',
                'technical-details': 'Technical Details',
                'error': 'Error:',
                'retry-attempts': 'Retry attempts:',
                'load-time': 'Load time:',
                
                // Analytics
                'total-apartments': 'Total Apartments',
                'units': 'units',
                'available': 'Available',
                'reserved': 'Reserved',
                'sold': 'Sold',
                'percent-of-total': '% of total',
                'bedroom-distribution': 'Bedroom Distribution',
                'bedrooms-label': 'Bedrooms:',
                'data-status': 'Data Status',
                'source': 'Source:',
                'last-update': 'Last Update:',
                'apartments-loaded': 'Apartments Loaded:',
                'current-view': 'Current View:',
                
                // Mobile Filter Toggle
                'show-filters': 'FILTERS',
                'hide-filters': 'HIDE FILTERS',
                
                // Contact Button
                'interested-button': 'I am interested',
                'email-subject': 'I am interested in Apartment %ID% - ParkLine Residences',
                
                // Contact Form
                'contact-form-title': 'Contact Us',
                'contact-form-description': 'Fill out the form below to inquire about an apartment or for general questions.',
                'form-name-label': 'Name:',
                'form-email-label': 'Email:',
                'form-phone-label': 'Phone (Optional):',
                'form-message-label': 'Message:',
                'form-apartment-id-label': 'Apartment ID (Optional):',
                'form-submit-button': 'Send Inquiry'
            },
            sq: {
                // Header and Navigation
                'view-1': 'Pamje 1',
                'view-2': 'Pamje 2',
                
                // Filters
                'filter-floor': 'KATI:',
                'filter-bedrooms': 'DHOMA GJUMI:',
                'filter-area': 'TOTAL (M¬≤):',
                'clear-filters': 'Fshij Filtrat',
                'restore-filters': 'Rivendos Filtrat',
                
                // Status
                'status-available': 'I LIR√ã',
                'status-reserved': 'I REZERVUAR',
                'status-sold': 'I SHITUR',
                
                // Apartment Details
                'apartment-details': 'Detajet e Apartamentit',
                'apartment-no': 'Apartamenti Nr.',
                'office-space': 'Zyr√´',
                'bedrooms': 'Dhoma Gjumi',
                'floor': 'Kati',
                'area': 'Sip√´rfaqja',
                'status': 'Statusi',
                'room': 'dhom√´',
                'rooms': 'dhoma',
                'floor-suffix': '. kat',
                'link': 'Lidhje',
                'na': 'N/A',
                
                // Loading and Error Messages
                'app-title': 'ParkLine Residences',
                'loading-data': 'Duke ngarkuar t√´ dh√´nat e apartamentit...',
                'initializing': 'Duke inicializuar...',
                'step': 'Hapi',
                'application-error': 'Gabim n√´ Aplikacion',
                'error-message': 'Kemi hasur nj√´ problem gjat√´ ngarkimit t√´ vizualizimit t√´ apartamentit. Kjo mund t√´ jet√´ p√´r shkak t√´ lidhjes s√´ rrjetit ose problemeve me ngarkimin e t√´ dh√´nave.',
                'reload-application': 'üîÑ Rindizni Aplikacionin',
                'technical-details': 'Detajet Teknike',
                'error': 'Gabim:',
                'retry-attempts': 'Tentativa t√´ rip√´rs√´ritjes:',
                'load-time': 'Koha e ngarkimit:',
                
                // Analytics
                'total-apartments': 'Gjithsej Apartamente',
                'units': 'nj√´si',
                'available': 'T√´ Lira',
                'reserved': 'T√´ Rezervuara',
                'sold': 'T√´ Shitura',
                'percent-of-total': '% e totalit',
                'bedroom-distribution': 'Shp√´rndarja e Dhomave t√´ Gjumit',
                'bedrooms-label': 'Dhoma Gjumi:',
                'data-status': 'Statusi i t√´ Dh√´nave',
                'source': 'Burimi:',
                'last-update': 'P√´rdit√´simi i Fundit:',
                'apartments-loaded': 'Apartamente t√´ Ngarkuara:',
                'current-view': 'Pamja Aktuale:',
                
                // Mobile Filter Toggle
                'show-filters': 'FILTRAT',
                'hide-filters': 'FSHIH FILTRAT',
                
                // Contact Button
                'interested-button': 'Jam i interesuar',
                'email-subject': 'Jam i interesuar p√´r Apartamentin %ID% - ParkLine Residences',
                
                // Contact Form
                'contact-form-title': 'Na Kontaktoni',
                'contact-form-description': 'Plot√´soni formularin m√´ posht√´ p√´r t√´ pyetur p√´r nj√´ apartament ose p√´r pyetje t√´ p√´rgjithshme.',
                'form-name-label': 'Emri:',
                'form-email-label': 'Email:',
                'form-phone-label': 'Telefoni (Opsional):',
                'form-message-label': 'Mesazhi:',
                'form-apartment-id-label': 'ID e Apartamentit (Opsional):',
                'form-submit-button': 'D√´rgo K√´rkes√´n'
            }
        };
        
        // Load saved language from localStorage
        const savedLanguage = localStorage.getItem('parkline-language');
        if (savedLanguage && this.translations[savedLanguage]) {
            this.currentLanguage = savedLanguage;
        }
    }

    // Get translation for a key
    t(key) {
        return this.translations[this.currentLanguage][key] || key;
    }

    // Get status display text
    getStatusDisplay(status) {
        const statusKey = `status-${status}`;
        return this.t(statusKey);
    }

    // Get bedroom text (singular/plural)
    getBedroomText(count) {
        return count === 1 ? this.t('room') : this.t('rooms');
    }

    // Get floor text with suffix
    getFloorText(floor) {
        if (this.currentLanguage === 'mk') {
            return `${floor}${this.t('floor-suffix')}`;
        } else if (this.currentLanguage === 'en') {
            const suffix = floor === 1 ? 'st' : floor === 2 ? 'nd' : floor === 3 ? 'rd' : 'th';
            return `${floor}${suffix} floor`;
        } else { // Albanian
            return `${floor}${this.t('floor-suffix')}`;
        }
    }

    // Get email subject with apartment ID
    getEmailSubject(apartmentId) {
        const template = this.t('email-subject');
        return template.replace('%ID%', apartmentId);
    }

    // Switch language
    switchLanguage(language) {
        if (!this.translations[language]) {
            console.warn(`Language ${language} not supported`);
            return;
        }

        this.currentLanguage = language;
        localStorage.setItem('parkline-language', language);
        
        // Update all translatable elements
        this.updateAllTranslations();
        
        // Update language switcher buttons
        this.updateLanguageSwitcher();
        
        // Trigger custom event for other components
        document.dispatchEvent(new CustomEvent('languageChanged', {
            detail: { language: language }
        }));
        
        console.log(`üåê Language switched to: ${language}`);
    }

    // Update all elements with data-i18n attributes
    updateAllTranslations() {
        const elements = document.querySelectorAll('[data-i18n]');
        elements.forEach(element => {
            const key = element.getAttribute('data-i18n');
            const translation = this.t(key);
            
            if (element.tagName === 'INPUT' && element.type === 'button') {
                element.value = translation;
            } else if (element.tagName === 'BUTTON') {
                element.textContent = translation;
            } else {
                element.textContent = translation;
            }
        });
        
        // NEW: Trigger apartment details refresh if visible
        if (apartmentDetailsManager && apartmentDetailsManager.isVisible && apartmentDetailsManager.currentApartment) {
            apartmentDetailsManager.showDetails(apartmentDetailsManager.currentApartment);
        }
    }

    // Update language switcher button visibility
    updateLanguageSwitcher() {
        const buttons = document.querySelectorAll('.language-btn');
        buttons.forEach(btn => {
            const lang = btn.getAttribute('data-lang');
            if (lang === this.currentLanguage) {
                btn.style.display = 'none';
            } else {
                btn.style.display = 'inline-block';
            }
        });
    }

    // Initialize the i18n system
    initialize() {
        console.log('üåê Initializing i18n system...');
        
        // Create language switcher
        this.createLanguageSwitcher();
        
        // Update all translations
        this.updateAllTranslations();
        
        // Update language switcher visibility
        this.updateLanguageSwitcher();
        
        console.log(`‚úÖ i18n initialized with language: ${this.currentLanguage}`);
    }

    // Create language switcher buttons
    createLanguageSwitcher() {
        const buildingContainer = document.querySelector('.building-container');
        if (!buildingContainer) return;

        // Check if language switcher already exists
        if (document.querySelector('.language-switcher')) return;

        const languageSwitcher = document.createElement('div');
        languageSwitcher.className = 'language-switcher language-switcher-image-top-right';
        
        const languages = [
            { code: 'mk', label: 'MK' },
            { code: 'en', label: 'EN' },
            { code: 'sq', label: 'SHQ' }
        ];

        languages.forEach(lang => {
            const button = document.createElement('button');
            button.className = 'language-btn';
            button.setAttribute('data-lang', lang.code);
            button.textContent = lang.label;
            button.onclick = () => this.switchLanguage(lang.code);
            languageSwitcher.appendChild(button);
        });

        buildingContainer.appendChild(languageSwitcher);
    }

    // Get current language
    getCurrentLanguage() {
        return this.currentLanguage;
    }

    // Get available languages
    getAvailableLanguages() {
        return Object.keys(this.translations);
    }
}

// Create global instance
const i18nManager = new I18nManager();

// Global function for easy access
function t(key) {
    return i18nManager.t(key);
}